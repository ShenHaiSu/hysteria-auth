import{b4 as g,k as o,C as m}from"./index-CurZRE90.js";import{a as w,g as U,c as x,u as L,d as S}from"./user-Bfv-Uxkn.js";const C=g("user",()=>{const r=o([]),l=o(null),a=o(!1),n=o(""),u=m(()=>{let t=r.value;if(n.value){const e=n.value.toLowerCase();t=r.value.filter(s=>s.username.toLowerCase().includes(e)||s.email.toLowerCase().includes(e))}return t.map(e=>({...e,formatted_created_at:e.created_at?new Date(e.created_at).toLocaleString():"-",formatted_updated_at:e.updated_at?new Date(e.updated_at).toLocaleString():"-",formatted_proxy_expire_at:e.proxy_expire_ts&&e.proxy_expire_ts>0?new Date(e.proxy_expire_ts*1e3).toLocaleString():"永久",formatted_last_login_at:e.last_login_ts&&e.last_login_ts>0?new Date(e.last_login_ts*1e3).toLocaleString():"从未登录",formatted_register_at:e.register_ts&&e.register_ts>0?new Date(e.register_ts*1e3).toLocaleString():"-",status_label:e.is_active?"正常":"禁用"}))});async function c(){a.value=!0;try{const t=await w();r.value=t}finally{a.value=!1}}function f(t){n.value=t}async function d(t){a.value=!0;try{return l.value=await U(t),l.value}finally{a.value=!1}}async function _(t){a.value=!0;try{const e=await x(t);return r.value.push(e),e}finally{a.value=!1}}async function v(t,e){a.value=!0;try{const s=await L(t,e),i=r.value.findIndex(p=>p.id===t);return i!==-1&&(r.value[i]=s),l.value?.id===t&&(l.value=s),s}finally{a.value=!1}}async function y(t){a.value=!0;try{const e=await S(t);return e.success&&(r.value=r.value.filter(s=>s.id!==t),l.value?.id===t&&(l.value=null)),e}finally{a.value=!1}}return{users:r,userVOs:u,currentUser:l,loading:a,search:n,fetchUsers:c,fetchUserById:d,addUser:_,editUser:v,removeUser:y,onSearch:f}});export{C as u};
