import{b4 as $,u as C,k as t}from"./index-CurZRE90.js";import{g as S}from"./node-rrHiEOCh.js";import{g as x}from"./user-Bfv-Uxkn.js";const w=(a,l,n,s,f,v)=>{const r=[];let i=n;if(s)if(s.includes("-"))r.push(`mport=${s}`);else{const d=parseInt(s,10);isNaN(d)||(i=d)}f&&(r.push("obfs=salamander"),r.push(`obfs-password=${f}`));const m=r.length>0?`?${r.join("&")}`:"",y=encodeURIComponent(v);return`hy2://${a}@${l}:${i}/${m}#${y}`},F=$("configDownload",()=>{const a=C(),l=t({server_group:"",ip_address:"",domain:"",is_active:1}),n=t(null),s=t(""),f=t(null),v=t("clash"),r=t(""),i=t(!1);function m(){l.value={server_group:"",ip_address:"",domain:"",is_active:1},n.value=null,s.value="",r.value=""}async function y(){i.value=!0;try{let e=await S(l.value);if(s.value){const o=s.value.toLowerCase();e=e.filter(u=>u.server_group.toLowerCase().includes(o)||u.domain&&u.domain.toLowerCase().includes(o)||u.ip_address.includes(o))}const p=n.value||a.user?.id,c=await d(p);if(!c)throw new Error("无法获取代理密码，请检查用户配置");const g=e.map((o,u)=>{const h=`${u.toFixed(0).padStart(2,"0")}_${o.server_group||"Hysteria2 Node"}`;return w(c,o.domain||o.ip_address,443,o.proxy_port,o.salamander,h)});r.value=g.join(`
`)}catch(e){console.error("生成配置失败:",e),r.value=`生成失败: ${e instanceof Error?e.message:String(e)}`}finally{i.value=!1}}async function d(e){return e||(await a.fetchMe(),e=a.user?.id),e?(await x(e)).proxy_password:""}async function _(e,p){try{const c=n.value||a.user?.id,g=await d(c);if(!g)throw new Error("无法获取代理密码");return w(g,e.domain||e.ip_address,e.server_port||443,e.proxy_port,e.salamander,p||e.server_group||"Hysteria2 Node")}catch(c){return console.error("生成单节点配置失败:",c),""}}return{filters:l,targetUserId:n,nodeSearch:s,selectedNode:f,configType:v,generatedConfig:r,loading:i,resetFilters:m,generateConfig:y,generateSingleConfig:_}});export{F as u};
